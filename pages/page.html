<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="../images/iconeFace.png" type="image/x-icon">
    <link href="https://fonts.googleapis.com/css2?family=Anton&family=Pacifico&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../style/logado.css">
    <link rel="stylesheet" href="../style/reset.css">
    <title id="tituloPage">Logado</title>
</head>

<body class="fundo" id="fundo">
    <div>
        <div id="minhaDiv">
            <button onclick="fechaPerfil()" class="fechaPerfil">Fechar</button>
            <div class="capa" id="capaPerfil"></div>
            <div class="paraFoto fotoPerfil" id="paraFoto">
            </div>
            <h1 class="nomePerfil" id="nomePerfil"></h1>
        </div>
    </div>
    <div class="fundoFalso" id="fundoFalso">
        <div class="barra" id="barra">
            <h1 id="textos" class="texto-barra"></h1>
            <p id="usuario-que-logou" class="usuario-que-logou"> </p>
            <img src="../images/sol.png" onclick="ModoClaro()" alt="sol" class="modo">
            <img src="../images/lua.png" onclick="ModoEscuro()" alt="lua" class="modo1">

            <div class="duvidas">
                <h1>
                    <a class="help" href="../pages/help.html">?</a> </h1>
            </div>
            <div class="menu_btn configs">
                <a href="#"></a>
                <h1 class="iconMenu">☟</h1>
                <div class="submenu">
                    <ul>
                        <li class="item">
                            <div class="titleItem" onclick="Mudarestado('minhaDiv')">Perfil</div>
                        </li>
                        <li class="item">
                            <div class="titleItem">Item</div>
                        </li>
                        <li class="item">
                            <div class="titleItem">Item</div>
                        </li>
                        <li class="item">
                            <div class="titleItem">Item</div>
                        </li>
                        <li class="item"
                            onclick="localStorage.setItem('usuarioAtual' , JSON.stringify('')); location.href='../pages/main.html'">
                            <div class="titleItem">Sair</div>
                        </li>
                    </ul>
                </div>
            </div>
        </div>


        <div class="pessoas">
            <div id="sugestaoAmigos">
                <h2 class="nameSujestao">Sugestão de amigos</h2>
                <div id="usuariosAdicionar">
                </div>
            </div>

            <div id="Amigos" class="Amigos">
                <h2 class="text-seusAmigos">Seus Amigos</h2>
                <div class="todosAmigos">
                    <div id="seuAmigo">

                    </div>
                </div>
            </div>
        </div>

        <!--<div class="publicar">
        <label>Título:</label>
        <input type="text" id="txtTitulo"/>
        <label>Subtítulo:</label>
        <input type="text" id="txtSubtitulo"/>
        <button id="btnEnviar" onclick="Publicar()">Publicar</button>
    </div>-->

        <!--Isso só vai aparecer se o botão for clicado-->
        <div id="geral">
            <div class="postagem">
                <button onclick="publicPic()" id="pbc-img">P/ Imagem</button>
                <button onclick="publicText()" id="pbc-text">P/ Texto</button>
                <div class="textinhos">
                    <h4 id="oquePublicar" class="oquePublicar">Oque você está pensando?</h2>
                        <h4 id="pessoaLogada" class="pessoaLogada">Teste</h4>
                </div>
                <textarea style="resize: none" name="pub-escrita" class="pub-escrita" id="pub-escrita" cols="30"
                    rows="10"></textarea>
                <textarea style="resize: none;" id="pub-image" placeholder="Insira o Link da imagem"></textarea>
                <textarea style="resize: none;" id="pub-vide" placeholder="Insira o link do video"></textarea>
            </div>
            <button class="publicar" onclick="publicar()" id="pbc-text2">Publicar Texto</button>
            <button class="publicarImagem" onclick="publicarImagem()" id="pbc-text2">Enviar Imagem</button>
            <button class="publicarVideo" onclick="publicarVideo()" id="pbc-text2">Publicar Video</button>
        </div>

        <div id="publicacao">
            <div id="pub" class="pub">
                <div id="text-dentro-pub"></div>
            </div>
        </div>

        <!--<div id="divResultado">-->
    </div>
    </div>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js">
    </script>
    <script src="../js/barraCode.js"></script>
    <script src="../js/Back.js.js"></script>
    <script>
        var usuarios = usuariosBack()
        var Amigos = amigosBack()
        var usuarioLogado = usuarioLogadoBack()
        if (!usuarioLogado.nomeUsuario) location.href = "../pages/main.html"

        let postagensText = postagensTextBack()
        let postagensVide = postagensVideBack()
        let postagensImg = postagensImgBack()

        let todasPubs = []

        let todosAmigos = []
        let todosAmigosId = []

        var agrupaPubs = todasPubs.concat(postagensText, postagensVide, postagensImg)
        console.log("concat", agrupaPubs)
        console.log('publication', todasPubs)
        todasPubs = agrupaPubs


        function carregaTodosPosts() {
            let postagem = document.getElementById("pub")
            let quantidade = todasPubs.length
            console.log("quantidade", quantidade)
            for (let i = 0; i < quantidade; i++) {
                console.log("todas pubs", todasPubs)
                console.log("pubs", todasPubs.tipo)
                if (todasPubs[i].tipo === "text") {
                    postagem.innerHTML += `<div class="dataPub">${todasPubs[i].data}</div>`
                    postagem.innerHTML += `<p class="nomeDeQuemPublicou">${todasPubs[i].from}</p>`
                    postagem.innerHTML += `<p class="postagem-paragrafo">${todasPubs[i].content}</p>`
                    postagem.innerHTML += `<div class="curtir">✔︎</div>`
                    console.log("texto")
                } else if (todasPubs[i].tipo === "video") {
                    postagem.innerHTML += `<div class="dataPub">${todasPubs[i].data}</div>`
                    postagem.innerHTML += `<p class="nomeDeQuemPublicou">${todasPubs[i].from}</p>`
                    postagem.innerHTML += `<video controls class="postagem-video"><source src="${todasPubs[i].content}" type="video/mp4"></source></video>`
                    postagem.innerHTML += `<div class="curtirVideo">✔︎</div>`
                    console.log("video")
                } else if (todasPubs[i].tipo === "img") {
                    postagem.innerHTML += `<div class="dataPub">${todasPubs[i].data}</div>`
                    postagem.innerHTML += `<p class="nomeDeQuemPublicou">${todasPubs[i].from}</p>`
                    postagem.innerHTML += `<img class="postagem-img" src="${todasPubs[i].content}">`
                    postagem.innerHTML += `<div class="curtir">✔︎</div>`
                    console.log("img")
                }
            }
        }
        carregaTodosPosts()

        function publicarVideo() {
            let publicador = usuarioLogado.nomeUsuario
            let p = document.getElementById("pub-vide").value
            if (!p) return alert("Sua publicação está vazia")
            let publicacoes = chamarLocalStorageVide()
            if (!publicacoes) publicacoes = []
            let data = new Date()
            data = data.toString()
            let postagem = document.getElementById("pub")
            postagem.innerHTML += `<div class="dataPub">${data}</div>`
            postagem.innerHTML += `<p class="nomeDeQuemPublicou">${publicador}</p>`
            postagem.innerHTML += `<video controls class="postagem-video"><source src="${p}" type="video/mp4"></source></video>`
            postagem.innerHTML += `<div class="curtirVideo">✔︎</div>`
            let vide = {
                from: publicador,
                content: p,
                data: data,
                tipo: "video"
            }
            publicacoes.push(vide)
            localStorageVide(publicacoes)
        }

        function publicPic() {
            var publicacao = document.getElementById("oquePublicar")
            var desaparece = document.getElementById("pbc-img")
            var Aparece = document.getElementById("pbc-text")
            desaparece.style.opacity = "0"
            Aparece.style.opacity = "100%"
            publicacao.innerHTML = "Insira o endereço de sua imagem"
        }

        function publicText() {
            var publicacao = document.getElementById("oquePublicar")
            var desaparece = document.getElementById("pbc-text")
            var Aparece = document.getElementById("pbc-img")
            desaparece.style.opacity = "0"
            Aparece.style.opacity = "100%"
            publicacao.innerHTML = "Oque você está pensando?"
        }

        function publicar() {
            let publicador = usuarioLogado.nomeUsuario
            let p = document.getElementById("pub-escrita").value
            if (!p) return alert("Sua publicação está vazia")
            let publicacoes = chamarLocalStorageText()
            if (!publicacoes) publicacoes = []
            let data = new Date()
            data = data.toString()
            let postagem = document.getElementById("pub")
            postagem.innerHTML += `<div class="dataPub">${data}</div>`
            postagem.innerHTML += `<p class="nomeDeQuemPublicou">${publicador}</p>`
            postagem.innerHTML += `<p class="postagem-paragrafo">${p}</p>`
            postagem.innerHTML += `<div class="curtir">✔︎</div>`
            let msg = {
                from: publicador,
                content: p,
                data: data,
                tipo: "text"
            }
            publicacoes.push(msg)
            localStorageText(publicacoes)
        }

        function publicarImagem() {
            let publicador = usuarioLogado.nomeUsuario
            let p = document.getElementById("pub-image").value
            if (!p) return alert("Sua publicação está vazia")
            let publicacoes = chamarLocalStorageImg()
            if (!publicacoes) publicacoes = []
            let data = new Date()
            data = data.toString()
            let postagem = document.getElementById("pub")
            postagem.innerHTML += `<div class="dataPub">${data}</div>`
            postagem.innerHTML += `<p class="nomeDeQuemPublicou">${publicador}</p>`
            postagem.innerHTML += `<img class="postagem-img" src="${p}">`
            postagem.innerHTML += `<div class="curtir">✔︎</div>`
            let Img = {
                from: publicador,
                content: p,
                data: data,
                tipo: "img"
            }
            publicacoes.push(Img)
            localStorageImg(publicacoes)
        }

        function carregaSugestoesAmigos() {
            let container = document.getElementById("usuariosAdicionar")
            let usuariosAmigos = usuariosAtuais();
            container.innerHTML = ""
            amigosQueJaAdicionou = carregaAmiguinhosBack()
            for (let i = 0; i < usuariosAmigos.length; i++) {
                if (usuarioLogado.nomeUsuario !== usuarios[i].nomeUsuario) {
                    var inexistente = todosAmigosId.indexOf(usuariosAmigos[i].id)
                    console.log(inexistente)
                    if (inexistente === -1) {
                        if (amigosQueJaAdicionou.indexOf(usuarios[i].nomeUsuario) === -1) {
                            container.innerHTML += `<div class="divUser"><p class="users">${usuariosAmigos[i].nomeUsuario}</p><div class="doButton"><button id="botaoAdicionar" onclick="adicionarAmigo(${usuariosAmigos[i].id} ,'${usuariosAmigos[i].nomeUsuario}')" class="botaoAdicionar">Adicionar</button></div></div>`
                        }
                    }
                }
            }
            console.log(todosAmigosId)
        }
        carregaSugestoesAmigos()


        function adicionarAmigo(ADuser, ADnome) {
            carregaSugestoesAmigos()
            alert(`Adicionando o amigo ${ADnome}`)
            todosAmigos.push(ADnome)
            todosAmigosId.push(ADuser)
            var todosSeusAmigos = document.getElementById("seuAmigo")
            todosSeusAmigos.innerHTML = ""
            let amiguinhos = amiguitosFunction()
            carregaSugestoesAmigos()
            for (let i = 0; i < todosAmigos.length; i++) {
                todosSeusAmigos.innerHTML += `<div class="divAmigo"><p class="seusAmigos">${todosAmigos[i]}</p><div class="doButtonAmigo"><button class="conversar">Conversar</button></div></div>`
            }

            mandaLocalStorageAdd(todosAmigos)

            carregaSugestoesAmigos()
        }

        function carregaAmiguinhos() {
            let amigosAparece = carregaAmiguinhosBack()
            if (!amigosAparece) return
            let amigosTamanho = amigosAparece.length
            let seuAmigoLocal = document.getElementById("seuAmigo")
            for (let i = 0; i < amigosTamanho; i++) {
                seuAmigoLocal.innerHTML += `<div class="divAmigo"><p class="seusAmigos">${amigosAparece[i]}</p><div class="doButtonAmigo"><button class="conversar">Conversar</button></div></div>`

            }
        }
        carregaAmiguinhos()


        console.log(todosAmigos.ADnome)
        console.log(todosAmigos)


        function Adicionar() {
            usuarios[0].amigos = [1]
        }



        $(document.body).ready(function () {
            textos = ['Compartilhe fotos', 'Publique textos', 'Conheça pessoas', 'Converse Muito', 'Divirta-se', 'Assista e compartilhe videos', 'RPB Games'];
            $('#textos').text(textos[0]);
            setInterval(function () {
                var indexTexto = Math.floor(Math.random() * textos.length); //Pegará um número aleatório entre 0 e a quantidade de textos;
                $('#textos').text(textos[indexTexto]); //Definirá o texto de acordo com o índice sorteado
            },
                1500); // segundo
        });

        function ModoEscuro() {
            var body = document.getElementById("fundo")
            var publicacaoColor = document.getElementById("geral")
            body.style.backgroundImage = "url('../images/img.png')"
            publicacaoColor.style.backgroundColor = "#143258"
            publicacaoColor.style.border = "solid 10px #00b8ff"
        }

        function ModoClaro() {
            var body = document.getElementById("fundo")
            var publicacaoColor = document.getElementById("geral")
            body.style.backgroundImage = "url('../images/img2.jpg')"
            body.style.backgroundSize = "1920px 1080px"
            publicacaoColor.style.backgroundColor = "rgb(215 233 255)"
            publicacaoColor.style.border = "solid 10px #00b8ff"
        }

        function pessoaQueLogou() {
            pessoaLogada = document.getElementById("pessoaLogada")
            pessoaLogada.innerHTML = usuarioLogado.nomeUsuario
        }
        pessoaQueLogou();
        carregaSugestoesAmigos();
    </script>
</body>

</html>